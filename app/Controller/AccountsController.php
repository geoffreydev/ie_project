<?php	App::import('component', 'CakeSession');   	App::uses('Controller', 'Users'); 		class AccountsController extends AppController	{		public $helpers = array('Html', 'Form','Js','Paginator');		public $name = "Accounts";		public $data = null;		var $uses = array('User', 'Event','Dog');		 		//Redirects if an admin		public function index()		{            $this->loadModel('PageContent');            $this->set('contactcontent', $this->PageContent->findByPage('contactus', 'content'));		$groupid = $this->Session->read('UserAuth.User.user_group_id');			if($groupid == 1)			{                $userId = $this->UserAuth->getUserId();                $this->User->id = $userId;                $user = $this->User->read();                $this->set('user', $this->User->read());				$this->redirect("/admin");			}			else			{				$userId = $this->UserAuth->getUserId();				$this->User->id = $userId;				$user = $this->User->read();				$this->set('user', $this->User->read());								$this->set("events", $this->Event->find("all",array('conditions' => array('Event.event_userid'=>$userId, 'Event.proplanning <'=>3), 'fields'=>array('Event.id','Event.hour','Event.minute','Event.event_theme', 'Event.date','Event.proplanning','Event.event_comment'))));				$this->set("dogs",$this->Dog->find("all",array('conditions'=>array('Dog.dog_userid'=>$userId, 'Dog.status'=>1),'fields'=>array('Dog.id','Dog.name','Dog.age_measure', 'Dog.breed','Dog.weight', 'Dog.sex','Dog.age', 'Dog.comment', 'Dog.status'))));							}		}				public function edit()		{            $this->loadModel('PageContent');            $this->set('contactcontent', $this->PageContent->findByPage('contactus', 'content'));			$userId = $this->UserAuth->getUserId();			$this->User->id = $userId;			//$this->set('user', $this->User->read());						if (!$this->User->exists())            {				throw new NotFoundException(__('I cannot find that user'));		    }			 			if (($this->request->is('post')) || ($this->request->is('put')))             {            	if (isset( $this->request->data['Cancel']))            	{                $this->Session->setFlash('Changes were not saved', true);                $this->redirect( array( 'action' => 'index' ));           		 }			   if ($this->User->save($this->request->data)) 			   { 			     $this->Session->setFlash('Your account details have been updated.');			     $this->redirect(array('controller' => 'accounts', 'action' => 'index')); 			   }			   else			   {			   $this->Session->setFlash('The information could not be saved. Please, try again.');			   }            }             else             {                 $this->request->data = $this->User->read(null, $userId);				//throw new NotFoundException(__('Something serious went wrong'));			}		}				public function changepassword(){			$userId = $this->UserAuth->getUserId();		if ($this->request -> isPost()) {			$this->User->set($this->data);				$this->User->id=$userId;				$this->request->data['User']['password'] = $this->UserAuth->makePassword($this->request->data['User']['password']);				$this->User->save($this->request->data,false);				$this->Session->setFlash(__('Password changed successfully'));				$this->redirect('/myaccount');					}		}				public function changepasswords() {		$userId = $this->UserAuth->getUserId();		if ($this->request -> isPost()) {			$this->User->set($this->data);							$user=array();				$user['User']['id']=$userId;				$salt=$this->UserAuth->makeSalt();				$user['User']['salt'] = $salt;				$user['User']['password'] = $this->UserAuth->makePassword($this->request->data['User']['password'], $salt);				$this->User->save($user,false);				$this->Session->setFlash(__('Password changed successfully'));				$this->redirect('/myaccount');					}			}			}				?>